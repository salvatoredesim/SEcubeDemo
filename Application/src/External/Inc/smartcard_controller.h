/*
 * smartcard_controller.h
 *
 *  Created on: 08 feb 2017
 *      Author: raidenfox
 */

#ifndef APPLICATION_SRC_EXTERNAL_INC_SMARTCARD_CONTROLLER_H_
#define APPLICATION_SRC_EXTERNAL_INC_SMARTCARD_CONTROLLER_H_

#include "stm32f4xx_hal.h"
#include <string.h>
#include <stdlib.h>
#include "smartcard.h"

#define CLA_AUTH_APPLET 	0xB0
#define INS_GET_PUBLIC_KEY 	0x13
#define INS_DECRYPT			0x11

/* EXAMPLE USAGE
uint8_t data_pubkey[128];
uint8_t decrypted[16];
uint8_t size;
select_auth_applet();
get_public_key(data_pubkey,&size);
uint8_t test_text[128] = {0x83,0xD2,0xD5,0x8A,0xEE,0xB9,0x94,0x76,0x90,0x63,0x03,0xE7,0x44,0xB2,0x3E,0x69,
						  0x65,0x80,0xE7,0x16,0x1C,0x88,0x32,0xD6,0xE4,0xA1,0x7A,0x80,0xE9,0x27,0x16,0x2C,
						  0xA5,0x85,0x76,0xA1,0x01,0x72,0xDE,0xC7,0xE2,0x9F,0x5B,0x3C,0x43,0x15,0xB9,0xDE,
						  0x2B,0x8E,0xE4,0xC1,0x0E,0x59,0xAA,0x7D,0x45,0x4D,0x52,0xF7,0xF6,0xE3,0x10,0x65,
						  0xCB,0x7D,0xDE,0x78,0x96,0x04,0x2C,0x3E,0xFB,0x8C,0x64,0xE2,0x8F,0x6E,0xBE,0xC7,
						  0x2C,0xC8,0xBD,0x71,0x88,0x26,0xCA,0x3A,0x07,0x47,0x33,0xCC,0x0B,0x8D,0x73,0xD1,
						  0x7A,0x3A,0x5D,0x55,0x06,0xE0,0x68,0x52,0xD7,0x5D,0x5D,0xF6,0x88,0xB1,0x7B,0xCF,
						  0x7D,0x36,0x99,0x6F,0x89,0x01,0x18,0xA1,0xD3,0xEF,0x5C,0x4B,0x1D,0x0B,0x61,0x37};
decrypt_keytext(test_text,128,decrypted,&size);
*/

SLJ52_APDU_Response select_apdu(uint8_t* id, uint8_t size);
SLJ52_APDU_Response get_response_apdu(uint8_t size);
SLJ52_APDU Build_GetResponse(uint8_t size);

void select_auth_applet();
void get_public_key(uint8_t* data,uint8_t* size_data);
void decrypt_keytext(uint8_t* data,uint8_t size_data,uint8_t* decrypted_key,uint8_t* size);
#endif /* APPLICATION_SRC_EXTERNAL_INC_SMARTCARD_CONTROLLER_H_ */
